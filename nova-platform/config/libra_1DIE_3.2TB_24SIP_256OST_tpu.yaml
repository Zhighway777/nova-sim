name:       tpu_vregs_vmem_hbm
arch:       tpu
arch_name:  tpu
inst_num:
  NUM_OF_CLUSTER:             1
  NUM_OF_CORE_PER_CLUSTER:    1
  NUM_OF_DSM:                 1
  NUM_OF_DIE:                 1
  NUM_OF_ESL_PER_DIE:         1

freq:
  CORE:          1.5
  INTERCONNECT:  1.5
  NOC:           1.5
  LLC:           1.5
  MC:            1.5
  L3:            0.8
  ESL:           1.0

compute:
  thread_2d_throughput:
    FP32:   256
    TF32:   512
    FP16:   512
    FP8:    512
    INT8:   512
  thread_1d_throughput:
    FP32:   64
    FP16:   128
    FP8:    128
  thread_sfu_throughput: 16
  compute_parallel_capability: 0
  # TPU 专用阵列参数（简化）
  tpu:
    ARRAY_M: 256
    ARRAY_N: 256
    K_TILE:  512

dte:
  THREAD_NUMBER:    1
  BW_PER_DTE_THEAD: 64

bw:
  xpu:
    freq_domain:        core
    otsd:               256
  cdte:
    freq_domain:        core
    otsd:               256
  l0:
    freq_domain:        core
    sic_io:             [[1, 0], 128, 1]
    local:              [[1, 0], 128, 1]
  local:
    freq_domain:        core
    sic_io:             [[1, 0], 128, 1]
  shared: null
  sic_io:
    freq_domain:        interconnect
    noc:                [[1, 0], 128, 1]
  noc:
    freq_domain:        noc
    llc:                [[1, 0], 128, 1]
    llc_far:            [[1, 0], 128, 1]
  llc:
    freq_domain:        llc
    mc:                 [[1, 0], 128, 1]
  llc_far: null
  mc:
    freq_domain:        mc
    l3:                 [[1, 0], 128, 1]
  l3:
    freq_domain:        l3
  esl:    null

memory:
  common:
    DSM_PRIVATE_SHARED_RATIO: 0.2
  # 映射：l0=VREGS，l1=VMEM，l3=HBM；l2/llc 为占位最小值
  l3:   # HBM
    TOTAL_SIZE: !eval 8 * 2**30
  llc:  # 最小占位
    CACHE_LINE_SIZE:  128
    CACHE_WAYS:       1
    CACHE_SIZE: !eval 64 * 2**10
    MEM_LATENCY:      100
    NON_MEM_LATENCY:  200
    NUM_MSHR:         16
    NUM_OF_PARTITIONS:            1
    NUM_OF_SLICES_PER_PARTITION:  1
  l2:   # 占位
    SIZE_PER_SIC: !eval 1 * 2**20
  l1:   # VMEM
    SIZE_PER_CORE: !eval 16 * 2**20
  l0:   # VREGS
    IV_SIZE : !eval 4 * 1024
    SMR_SIZE: !eval 4 * 1024
    OA_SIZE: !eval 256 * 512

power: !include pw_libra.yaml
